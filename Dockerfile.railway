FROM node:18-alpine

# Force rebuild - v2
WORKDIR /app

COPY package.json ./

RUN npm install --omit=dev

COPY server-simple.js ./

RUN addgroup -g 1001 -S nodejs && \
    adduser -S voxlink -u 1001 && \
    chown -R voxlink:nodejs /app

USER voxlink

EXPOSE 8080

ENV PORT=8080
ENV NODE_ENV=production

CMD ["node", "server-simple.js"]
